= Change the Version of an API Asset
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../assets/images/

Anypoint Exchange lets you create API assets for:

* REST API (RAML or OAS)
* HTTP API
* SOAP API

This document describes how to change the version for any of these assets. Exchange versions follow the https://semver.org/[Semantic Versioning] model of major, minor, and patch releases. Each asset contains a Version field.

An HTTP API asset is an endpoint, to which you can provide only policies or proxies. HTTP APIs have only major version increases and do not have minor or patch version changes.

When creating a new version of an asset, the name, icon, and description of the previous version are used. To change these properties use the instructions in xref:to-describe-an-asset.adoc[Describe an Asset]. Any changes to the name, icon, or description apply to all versions of the asset.

NOTE: New asset versions count toward your organization's xref:to-create-an-asset.adoc#asset-limits[asset limit].

== Deploy a New API Asset

You can deploy an API asset directly into Exchange using the *New asset* button. In the *Publish a new asset* window, the Advanced section enables you to specify the version of the asset in the *Version* field.

image::ex-publish-a-new-asset.png[]

You should only change the major version when an updated API specification contains changes that are not compatible from the new version to the old version.

== Change RAML or OAS Version

For RAML and OAS API specifications within Exchange, you can change the version number from within Exchange using the *Add new version* button in the Exchange user interface.

image::ex-add-new-version.png[]

This opens the *Publish a new asset* window (as shown in <<Deploy a New API Version>>).

These fields are required: *File upload*, *Main file*, and *Version*.

[%header%autowidth.spread]
|===
|Field |Description
|File upload |For OAS, choose an OAS file with the .yaml or .json file types.
For RAML, choose a RAML file with the .raml file type. Zip files are also accepted with the 
file to upload residing in the zip file's root directory.
|Main file |Specify the main file if the uploaded file is a zip. Otherwise, Exchange uses the same file name as the file you upload.
|Version |The new version number.
|===

You can also change the version number for RAMLs as described in the next sections.

=== Change a RAML Version from Its Specification

Change the `version:` element in your RAML specification.
You can use a text editor or API Designer in the Design Center feature of Anypoint Platform.
When you update the version element in the RAML specification and publish to Exchange, the publish menu automatically picks up the change from the `version:` element.

=== Change a RAML Version When you Publish to Exchange

. From Design Center, open your API. No changes are necessary.
. Click the Publish to Exchange button.
+
image::apim-publish-api-spec.png[]
+
. Change the asset version.

[[best-practices-api-versioning]]
== Best Practices for API Versioning

An API should be designed for long term use, but because change is inevitable, the API 
can never be completely stable. 

What is important is to manage the changes through a comprehensive versioning 
strategy. This includes a multiple month deprecation schedule and documentation that 
is up to date and describes the change in sufficient level of detail. 

Not all changes require a new version. APIs designed for backward compatibility 
normally do not require a minor change, but should require a patch change. 

Nevertheless, it is not always possible to design APIs in 
that way. The table below outlines when to introduce a new version and when a 
new version is not required. Typically when one clicks *Add new API operation* 
a patch version increase occurs.

[%header,cols="20a,60a,20a"]
|===
|Type of Change |Changes Requiring a Major Version |New Version is Not Required
| Service contract |

* Remove API endpoint
* Change in the effect of an API operation
* Change in the response type of an API operation
* Add new required operation argument
| Add new API operation
| Data contract |

* Remove an existing element (or attribute)
* Add new required element (or required attribute)
* Change an existing element (or attribute)
|

* Add an optional element (or attribute)
* Add a derived element type
|Representation format |Remove existing representation |Add new representation
|Accessibility |Restrict permissions |Relax permissions
|===

=== When to Introduce a New Version

You should introduce a new version for:

* Quality of service (QoS) -- When a change affects the quality of service, such as response time and availability, the major version may need to change as the QoS can break applications that use the API.
* Output message domain value changes -- Applications that use the API depend on the domain of values of fields in response messages. For instance, the API may only return certain products or specific payment methods. If the API starts returning values outside of a domain, it can adversely affect existing consumers. In this case, consider introducing a new major version.

=== When to Change Version Numbers

* Major versions: When introducing a change in the structure of the API that requires the user of the API to adopt the interface on the consumer side.
* Minor versions: When introducing a change to the API that does not require an API user to change, or when fixing a bug. A minor version increase should be when the user can still use the same API version but the version breaks compatibility with the previous one. See https://semver.org/[Semantic Versioning] for more information.
* Patch versions: When introducing a backward-compatible change.

=== API Version in Application URL

Include the API version in the application URL so that consumers can choose which version they want to call. 

* For on-premises deployment, the version is in the base URI and appears in the URL:
+
`+http://www.example.org/v1/api/customer/1234+`

=== Naming Conventions

You can use these rules to define an API version:

* Specify the version with a "v" prefix.
* Use a simple ordinal number, for example, "v1","v2", and so on.
* Avoid using dot notation, for example, "v1.2".
* Only specify the major version as part of the URL.

== Document an API Version

Exchange provides documentation pages with information about an asset for API consumers. 
You can create different documentation pages for each minor version.

Select the version to edit with the menu next to the API Name.
